# Scipy 中的稀疏矩阵

## 为什么要引入稀疏矩阵

给定 $n$ 阶矩阵 $A$， 如果其非零元的个数比较少， 我们就称其**稀疏矩阵**。 这样在计算机中存储 $A$ 时， 如果每个元素都存下来， 是很浪费存储空间的。 比如一个 10 万阶的矩阵, 就有 $10^{10}$ 个元素， 但其中只有 10 万个非零元。 每个元素双精度存储, 要占 8 个字节, 如果把所有元素都存储下来, 大概需要 74.5 GB 的内存空间， 其计算公式如下：

$$ 
\begin{eqnarray} 
\frac{\mbox{10 万阶矩阵的字节数}}{\mbox{1 GB 的字节数}} = \frac{10^5\times 10^5\times 8}{2^{10}\times 2^{10}\times 2^{10}} = 74.5 (GB), \end{eqnarray} 
$$

对一般中小规模的计算机， 这是难以承受的。 你会注意到上面的矩阵只有 10 万个非零元， 所以这个矩阵中的大部分元素是 0， 这样的矩阵称为**稀疏矩阵**。 很显然， 存储这些 0 元是没有必要的。 人们必须为稀疏矩阵设计新的存储格式。 常用的稀疏矩阵存储格式有：

* Coordinate format Matrix (COO): 坐标格式稀疏矩阵， 用相同长度的三个数组 
`data`, `I` 和 `J` 分别存**非零元**及其对应的**行列指标**， 数组长度为非零元的个数。
* Compressed Sparse Row Matrix (CSR): 压缩稀疏行存储矩阵， 用两个个相同长度的数组 `data` 和 `indices` 分别存储**非零元**和其对应的**列指标**， 长度为非零元的个数; 用另外一个数组 `indptr` 存储**每一行**的非零元和其列指标在 `data` 和 `indices` 中的起始和终止位置， 长度要比**矩阵行数**多 1。
* Compressed Sparse Column Matrix (CSC)：压缩稀疏列存储矩阵，用两个个相同长度的数组 `data` 和 `indices` 分别存储**非零元**和其对应的**行指标**， 长度为非零元的个数; 用另外一个数组 `indptr` 存储**每一列**的非零元和其列指标在 `data` 和 `indices` 中的起始和终止位置， 长度要比**矩阵列数**多 1。



## 稀疏矩阵示例

下面以一个具体的矩阵为例， 对上面三种格式进行说明:

$$ 
A = \begin{pmatrix} 
 0 & 0 & 0 & 10 \\
 21 & 0 & 33 & 0 \\ 
 0 & 0 & 3 & 0 \\ 
 12 & 1 & 0 & 4 
 \end{pmatrix} 
$$

**注意**下面我们采用 C\C++ 和 Python 的习惯， 矩阵行列编号都从 **0** 开始. 首先是 COO 格式， 可以**行优先存储**:

$$ 
\begin{eqnarray} 
data &=& [10,21,33,3,12,1,4], \\
I &=& [0, 1, 1, 2, 3, 3, 3], \\
J &=& [3, 0, 2, 2, 0, 1, 3]. 
\end{eqnarray} , 
$$
也可以**列优先存储**:
$$ 
\begin{eqnarra
data &=& [21, 12, 1, 33, 3, 10, 4], \\
I &=& [1, 3, 3, 1, 2, 0, 3], \\
J &=& [0, 0, 1, 2, 2,, 3, 3]. \\ 
\end{eqnarray} 
$$

而 CSR 可以用下面三个数组来表示矩阵 $A$
$$ 
\begin{eqnarray} 
data &=& [10,21,33,3,12,1,4], \\
indices_{col} &=& [3,0,2,2,0,1,3], \\ 
indptr_{row} &=& [0,1,3,4,7]. \\
\end{eqnarray} 
$$

CSC 可以用下面三个数组来表示矩阵 $A$:
$$ 
\begin{eqnarray} 
data &=& [21,12,1,33,3,10,4], \\
indices_{row} &=& [1,3,3,1,2,0,3], \\
indptr_{col} &=& [0,2,3,5,7]. 
\end{eqnarray} 
$$

还以上面的 10 万阶的矩阵为例, 它有 10 万个非零元, 在 CSR 模式下, 它占 的内存为(以 MB 为单位):

$$ \begin{eqnarray} \frac{(10^5\times 3 + 1)\times 8}{2^{10}\times 2^{10}\times 2^{10}} \approx 2.29 (MB), \end{eqnarray} $$

哈哈, 内存节省了 10 万倍.